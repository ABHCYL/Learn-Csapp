## 第八章
### 8.1 异常
异常（exception）就是控制流中的突变，用来响应处理器状态中的某些变化。
任何情况下，当处理器检测到有事件发生时，它会通过一张名为异常表的跳转表，进行一个间接过程的调用，使用异常处理程序（运行在内核模式下）来处理这类事件。这类事件包括被零除、缺页、算术溢出、I/O请求完成。
异常处理程序完成处理后，会发生以下三种情况：
>1.处理程序将控制放回给当前指令Icurr,即事件发生时正在执行的指令。
 2.将控制返回给Inext。
 3.终止被中断的程序。

![](https://github.com/ABHCYL/Learn-Csapp/blob/main/%E7%AC%AC8%E7%AB%A0/8.1.png)
异常分为异步异常和同步异常。异步异常是硬件中断（称为中断处理程序），是有外部IO设备造成的，同步异常是执行当前指令的结果（称为故障指令）。

![](https://github.com/ABHCYL/Learn-Csapp/blob/main/%E7%AC%AC8%E7%AB%A0/8.2.png)

### 8.2 进程
经典的定义是：一个执行中的程序的实例。进程提供给应用程序的关键抽象：（1）一个独立的逻辑控制流；（2）一个私有的地址空间。其实就是操作系统的三大主题之一的虚拟化（虚拟化CPU 和 虚拟化 内存）
### 8.4 进程控制
进程有三个主要状态：
>1.运行 Running     
    正在被执行、正在等待执行或者最终将会被执行     
2.停止 Stopped   
    执行被挂起，在进一步通知前不会计划执行       
    3.终止 Terminated     
    进程被永久停止     

进程图

![](https://github.com/ABHCYL/Learn-Csapp/blob/main/%E7%AC%AC8%E7%AB%A0/8.3.png)

回收子进程      
一个终止了但是没有被回收的进程称为僵尸进程。如果父进程已经终止了，那么对应的没终止的子进程就称为孤儿进程。对于孤儿进程，内核会安排init进程称为他的孤儿进程的养父。init进程的PID是1，是在操作系统启动后由内核创建的，init进程会回收孤儿进程。
### 8.5 信号
信号就是一条小消息，它通知进程：系统中发生了某事件。相较于前面的操作系统的上下文切换的低级异常处理逻辑，信号是更高级的软件形式的异常处理逻辑。
信号分为两部分，发送信号和接受信号。
![](https://github.com/ABHCYL/Learn-Csapp/blob/main/%E7%AC%AC8%E7%AB%A0/8.4.png)
### 8.6 非本地跳转 Non local Jump
本地跳转，指的是在一个程序中通过 goto 语句进行流程跳转。本地跳转的限制在于，我们不能从一个函数跳转到另一个函数中。如果想突破函数的限制，就要使用 setjmp 或 longjmp 来进行非本地跳转。

setjmp 保存当前程序的堆栈上下文环境(stack context)，注意，这个保存的堆栈上下文环境仅在调用 setjmp 的函数内有效，如果调用 setjmp 的函数返回了，这个保存的堆栈上下文环境就失效了。调用 setjmp 的直接返回值为 0。
longjmp 将会恢复由 setjmp 保存的程序堆栈上下文，即程序从调用 setjmp 处重新开始执行，不过此时的 setjmp 的返回值将是由 longjmp 指定的值。注意longjmp 不能指定0为返回值，即使指定了 0，longjmp 也会使 setjmp 返回 1。

C++ 和 Java 的异常机制是 setjmp 和 longjmp 的更加结构化的版本。try catch 类似 setjmp，throw 类似 longjmp。

